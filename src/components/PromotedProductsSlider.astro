---
import { Carousel } from "astro-bootstrap";
import MarttiiniPicture from "./MarttiiniPicture.astro";

import type { PromotedContentProduct } from "../content/product.repository";

interface Props {
  promotedProducts: PromotedContentProduct[];
  imagesOrientationMap: Record<string, "landscape" | "portrait">;
}

const carouselId = "promotedProductsCarousel";
const { promotedProducts, imagesOrientationMap } = Astro.props;

const slides = promotedProducts.map((p, i) => ({
  active: i === 0,
  alt: p.image?.altText || p.name,
  img: p.image?.url || "",
}));
---

<section class="promoted-products">
  <Carousel id={carouselId} class="h-100" dark>
    <Carousel.Inner>
      {
        promotedProducts.map((product, idx) => {
          const orientation = imagesOrientationMap[product.manufacturer];
          const isLandscape = orientation === "landscape";
          return (
            <Carousel.Item active={idx === 0}>
              <div
                class="row align-items-center"
                style="min-height: 500px;"
              >
                <div
                  class={`${isLandscape ? "col-md-8" : "col-md-6"} d-flex justify-content-center align-items-center`}
                >
                  {product.image.url ? (
                    <MarttiiniPicture
                      src={product.image.url}
                      alt={product.image.altText || product.name}
                      place="front-slider"
                      imageOrientation={orientation}
                    />
                  ) : (
                    <div
                      class="placeholder-image bg-secondary d-flex align-items-center justify-content-center"
                      style="height: 400px; width: 100%;"
                    >
                      <span class="text-white">No Image</span>
                    </div>
                  )}
                </div>
                <div class={isLandscape ? "col-md-4" : "col-md-6"}>
                  <div class="p-4">
                    <h2 class="fw-bold mb-2 display-6">{product.name}</h2>
                    <p class="text-muted mb-0">
                      {product.manufacturer}
                    </p>
                  </div>
                </div>
              </div>
            </Carousel.Item>
          );
        })
      }
    </Carousel.Inner>
    <!-- <Carousel.Controls id={carouselId} /> -->
    <Carousel.Indicators id={carouselId} slides={slides} />
  </Carousel>
</section>
