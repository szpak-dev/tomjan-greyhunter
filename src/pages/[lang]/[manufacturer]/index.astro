---
import Layout from "../../../layouts/Layout.astro";
import { categoryRepository, manufacturerRepository } from "../../../content";
import { getOwnerStory } from "../../../content/site.repository";
import Section from "../../../components/ui/Section.astro";
import OfficialDistributor from "../../../components/OfficialDistributor.astro";
import CategoryCard from "../../../components/product/CategoryCard.astro";

export async function getStaticPaths() {
  return [
    { params: { lang: "en", manufacturer: "marttiini" } },
    { params: { lang: "pl", manufacturer: "marttiini" } }
  ];
}

const { lang, manufacturer } = Astro.params;
const manufacturerData = await manufacturerRepository.get(manufacturer, lang);
const allCategories = await categoryRepository.findCategories(lang);
const manufacturerCategories = allCategories.filter((c) => c.manufacturer === manufacturer);
const ownerStory = getOwnerStory(manufacturer, lang);
---

<Layout title={manufacturerData.name} lang={lang}>
  <div class="manufacturer-page animate-fade-in">

    <OfficialDistributor manufacturer={manufacturerData} ownerStory={ownerStory} />

    <Section heading="Kategorie produktÃ³w" divider={true}>
      <div class="row row-cols-1 row-cols-md-3 g-4 animate-stagger">
        { manufacturerCategories.map((category) => <CategoryCard category={category} /> ) }
      </div>
    </Section>
  </div>
</Layout>