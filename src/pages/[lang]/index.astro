---
import { siteRepository, manufacturerRepository, frontpageRepository } from "../../content";
import type { MossaicPicture } from "../../content/frontpage.repository";
import FrontPage from "../../layouts/FrontPage.astro";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  return siteRepository.getAvailableLanguages().map((lang) => ({ params: { lang: lang.code } }));
}

const { lang } = Astro.params;
const sliderItems = frontpageRepository.getSliderItems("marttiini");
const looseManufacturers = await manufacturerRepository.findAll(lang);
const manufacturers = manufacturerRepository.sortForFrontPage(looseManufacturers);
const newProducts = await frontpageRepository.findNewProducts("marttiini", lang);

const mossaicImages: MossaicPicture[] = frontpageRepository.getMossaic();
const socials = siteRepository.getSocialAccounts();
const owner = siteRepository.getSiteOwner();
const languages = siteRepository.getAvailableLanguages();
const currentLanguage = siteRepository.getLanguage(lang);
const navigationItems = siteRepository.getNavigationItems(lang);
const allNavigationItems = siteRepository.getAllNavigationItems();
---

<Layout 
  title="Grey Hunter - Tomasz Jantos" 
  {lang} 
  {socials} 
  {owner} 
  {languages} 
  {currentLanguage} 
  {navigationItems} 
  {allNavigationItems}
>
  <FrontPage 
    {lang}
    {sliderItems}
    {manufacturers}
    {newProducts}
    {mossaicImages}
  />
</Layout>