---
import Layout from "../../layouts/Layout.astro";
import ContentPage from "../../layouts/ContentPage.astro";
import ContactPage from "../../layouts/ContactPage.astro";
import { siteRepository } from "../../content";

export async function getStaticPaths() {
  const languages = siteRepository.getAvailableLanguages();
  const paths = [];

  for (const language of languages) {
    const navigationItems = siteRepository.getNavigationItems(language.code);
    for (const item of navigationItems) {
      paths.push({
        params: { 
          lang: language.code,
          slug: item.slug
        },
        props: {
          id: item.id
        }
      });
    }
  }

  return paths;
}

const { lang, slug } = Astro.params;
const { id } = Astro.props;

const page = siteRepository.getContentPage(id, lang);
const navigationItems = siteRepository.getNavigationItems(lang);
const socials = siteRepository.getSocialAccounts();
const owner = siteRepository.getSiteOwner();
const languages = siteRepository.getAvailableLanguages();
const currentLanguage = siteRepository.getLanguage(lang);

// Build navigation items for all languages
const allNavigationItems: Record<string, any[]> = {};
for (const language of languages) {
  allNavigationItems[language.code] = siteRepository.getNavigationItems(language.code);
}
---

<Layout
  title={page.title}
  {lang}
  {socials}
  {owner}
  {languages}
  {currentLanguage}
  {navigationItems}
  currentId={id}
  {allNavigationItems}
>
  {id === "contact" ? (
    <ContactPage {page} {lang} {owner} />
  ) : (
    <ContentPage {page} />
  )}
</Layout>
